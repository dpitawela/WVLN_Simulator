import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { StoreModel } from '../types/model';
import { lastValueFrom } from 'rxjs';

@Injectable({
  providedIn: 'root'
})

export class LambdaService {

  constructor(private httpClient: HttpClient) {
  }

  async storeActions(model: StoreModel): Promise<string> {
    let result: string = ''

    const func_url: string = "https://panjwnqvwtp2z7trs7gj2giw7e0beqds.lambda-url.ap-southeast-2.on.aws/"
    let payload: string = JSON.stringify(model)
    console.log(payload)

    // await lastValueFrom(this.httpClient.post<any>(func_url, payload)).then((data: any) => {
    //   result = data.successToken
    // }).catch((error) => {
    //   console.log(error)
    // })

    console.log("recorded")
    return result
  }


  async readActions(token: string): Promise<StoreModel | null> {
    let result: string | null = null

    if (token != '' && token.startsWith('R_')) {
      const func_url: string = "https://mbagrtl5aac2do7n72zn3xae3m0uowbu.lambda-url.ap-southeast-2.on.aws/"
      let payload: string = JSON.stringify(token)

      await lastValueFrom(this.httpClient.post<string>(func_url, payload)).then((data: string) => {
        result = data
      }).catch((error) => {
        console.log(error)
      })
    }


    // result =
    //   '{"url":"assets/crawled/hansel/hanselfrombasel.com/index.html","actions":[{"type":"click","x":289.8125,"y":551.03125,"height":47.78125,"width":223.375,"x_offset":0,"y_offset":0,"href":"collections/womens-new-arrivals.html","outer_html":"PGEgaHJlZj0iY29sbGVjdGlvbnMvd29tZW5zLW5ldy1hcnJpdmFscy5odG1sIiBjbGFzcz0iYnV0dG9uCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi1tZWRpdW0KICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLXdoaXRlCiAgICAgICAgICAgICAgICAgICAgICAgIHR4dC1zaXplLTIKICAgICAgICAgICAgICAgICAgICAgICAgdHh0LXRyYWNrZWQtdHdvLXBvaW50Ij4KICAgICAgICAgICAgICAgICBTaG9wIE5ldyBBcnJpdmFscwogICAgICAgICAgICAgIDwvYT4="},{"type":"click","x":607.8125,"y":337.796875,"height":222.9375,"width":167.203125,"x_offset":0,"y_offset":0,"href":"womens-new-arrivals/products/sustainability-rules-short-crew.html","outer_html":"PGEgaHJlZj0id29tZW5zLW5ldy1hcnJpdmFscy9wcm9kdWN0cy9zdXN0YWluYWJpbGl0eS1ydWxlcy1zaG9ydC1jcmV3Lmh0bWwiPgogICAgPGltZyBjbGFzcz0iYnVuZGxlLWJhZGdlIiBzcmM9Ii4uLy4uL2Nkbi5zaG9waWZ5LmNvbS9zL2ZpbGVzLzEvMDc4MC80OTkxL3QvMjcvYXNzZXRzL2J1bmRsZV9hbmRfc2F2ZV80NTB4NDMzZjVkMS5wbmc/dj0xMjI2MTU5NzY1OTg5MDA2MDUzMTE2MjMwODkwNzkiPgogICAgCiAgICAgIDxpbWcgc3JjPSIuLi8uLi9jZG4uc2hvcGlmeS5jb20vcy9maWxlcy8xLzA3ODAvNDk5MS9wcm9kdWN0cy9oZmJfMTEwOTcwX3N1c3RhaW5hYmlsaXR5X3J1bGVzX2NyZXdfY2hhcmNvYWxfMTAyNHgxMDI0ODRlZi5qcGc/dj0xNjUwNDMyNzQ3IiBhbHQ9ImNoYXJjb2FsIiBjbGFzcz0icHJvZHVjdC1jYXJkLWltYWdlIGlzLWFjdGl2ZSI+CiAgICAKICA8L2E+"},{"type":"click","x":414.28125,"y":321.8125,"height":45.765625,"width":231.71875,"x_offset":0,"y_offset":60,"href":"#","outer_html":"PGlucHV0IHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ1dHRvbiBidXR0b24td2lkZSBqcy1hZGQtdG8tY2FydCIgZGF0YS1kcmF3ZXI9ImNhcnQiIGRhdGEtY2hlY2tvdXQ9IjQwNzc1MDIwNjQyMzUxIiBuYW1lPSJhZGQiIHZhbHVlPSJhZGQgdG8gY2FydCI+"},{"type":"click","x":427.625,"y":328.828125,"height":45.765625,"width":349.25,"x_offset":0,"y_offset":60,"href":"#","outer_html":"PGJ1dHRvbiB0eXBlPSJzdWJtaXQiIG5hbWU9ImNoZWNrb3V0IiBjbGFzcz0iYnV0dG9uIGJ1dHRvbi1zbWFsbCBidXR0b24td2lkZSB0eHQtY2VudGVyIj4KICAgICAgICAgIDxzcGFuPkNoZWNrb3V0PC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9IkJ1dHRvbl9fU2VwYXJhdG9yRG90Ij48L3NwYW4+CiAgICAgICAgICA8c3BhbiBydi1odG1sPSJjYXJ0LnRvdGFsX3ByaWNlIHwgbW9uZXlfd2l0aF9jdXJyZW5jeSBDdXJyZW5jeS5jdXJyZW50Q3VycmVuY3kiPiQwLjAwPC9zcGFuPgogICAgICAgIDwvYnV0dG9uPg=="},{"type":"click","x":550.90625,"y":378.84375,"height":19.984375,"width":84.296875,"x_offset":0,"y_offset":1460,"href":"https://instagram.com/hanselfrombasel/","outer_html":"PGEgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJpY29uLWluc3RhZ3JhbQogICAgICAgICAgICAgICAgICAgIGZvb3Rlci1saW5rCiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLWxpbmstc29jaWFsIiBocmVmPSJodHRwczovL2luc3RhZ3JhbS5jb20vaGFuc2VsZnJvbWJhc2VsLyI+CiAgICAgICAgICAgIEluc3RhZ3JhbQogICAgICAgICAgPC9hPg=="},{"type":"click","x":303.5,"y":61.953125,"height":27,"width":196,"x_offset":0,"y_offset":0,"href":"../../../index.html","outer_html":"PGEgaHJlZj0iLi4vLi4vLi4vaW5kZXguaHRtbCIgY2xhc3M9Im5hdi1sb2NrdXAiPgogICAgICAgIDxpbWcgY2xhc3M9Im5hdi1uYXJyb3ctc2hvdyIgc3JjPSIuLi8uLi8uLi8uLi9jZG4uc2hvcGlmeS5jb20vcy9maWxlcy8xLzA3ODAvNDk5MS90LzI3L2Fzc2V0cy9oZmJfbG9nb18zOTJweDlhNDAucG5nP3Y9Njk5Mjc5MzEzMDIzMTUyNDIxNjE2Nzk2NjI3IiBhbHQ9IkhhbnNlbCBmcm9tIEJhc2VsIj4KICAgICAgICA8aW1nIGNsYXNzPSJuYXYtd2lkZS1zaG93IiBzcmM9Ii4uLy4uLy4uLy4uL2Nkbi5zaG9waWZ5LmNvbS9zL2ZpbGVzLzEvMDc4MC80OTkxL3QvMjcvYXNzZXRzL2hmYl9sb2dvXzU1MHB4MTI5My5wbmc/dj0xNTcwNzMwMzQxMDEwMzAzMTY0MDE2MTY3OTY2MjgiIGFsdD0iSGFuc2VsIGZyb20gQmFzZWwiPgoKICAgICAgPC9hPg=="}]}'
    // '{"url":"assets/crawled/hansel/hanselfrombasel.com/index.html","actions":[{"type":"click","x":26.96875,"y":57.96875,"height":34.984375,"width":35,"x_offset":0,"y_offset":0,"href":"#","outer_html":"PGEgaHJlZj0iIyIgY2xhc3M9Im5hdi1saW5rCiAgICAgICAgICAgICAgICBqcy10b3AtZHJhd2VyLWNsaWNrIiBkYXRhLXRvcD0ic3VibmF2Ij4KICAgICAgICA8IS0tP3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJVVEYtOCI/LS0+CjxzdmcgY2xhc3M9Imljb24gaWNvbi1tZW51IiB2aWV3Qm94PSIwIDAgMTcgOSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNDcgKDQ1Mzk2KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5Hcm91cCBDb3B5bWVudTwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiPgogICAgICAgIDxnIGlkPSJtb2JpbGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xOC4wMDAwMDAsIC0zNy4wMDAwMDApIiBzdHJva2U9IiMwMDAwMDAiPgogICAgICAgICAgICA8ZyBpZD0iR3JvdXAtQ29weSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTguMDAwMDAwLCAzNy4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0wLjUsMC41IEwxNi41LDAuNSIgaWQ9IkxpbmUiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0wLjUsNC41IEwxNi41LDQuNSIgaWQ9IkxpbmUtQ29weSI+PC9wYXRoPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTAuNSw4LjUgTDE2LjUsOC41IiBpZD0iTGluZS1Db3B5LTIiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+CiAgICAgIDwvYT4="},{"type":"click","x":14,"y":233.0644989013672,"height":40.78126525878906,"width":763,"x_offset":0,"y_offset":0,"href":"collections/womens.html","outer_html":"PGEgaHJlZj0iY29sbGVjdGlvbnMvd29tZW5zLmh0bWwiIGNsYXNzPSJ0b3BuYXYtbW9iaWxlLWxpbmsiIGlkPSJuYXYtbWFpbi13b21lbnMiIGFsdD0iV29tZW4ncyI+CiAgICAgICAgICAgIFdvbWVuJ3MKICAgICAgCSAgPC9hPg=="},{"type":"click","x":14,"y":335.62701416015625,"height":40.78125,"width":763,"x_offset":0,"y_offset":0,"href":"collections/womens-new-arrivals.html","outer_html":"PGEgaHJlZj0iY29sbGVjdGlvbnMvd29tZW5zLW5ldy1hcnJpdmFscy5odG1sIiBjbGFzcz0idG9wbmF2LW1vYmlsZS1saW5rIiBpZD0ibmF2LW1haW4tbmV3LWFycml2YWxzIiBhbHQ9Ik5ldyBBcnJpdmFscyI+CiAgICAgICAgICAgIE5ldyBBcnJpdmFscwogICAgICAJICA8L2E+"},{"type":"click","x":61.96875,"y":57.96875,"height":34.984375,"width":35,"x_offset":0,"y_offset":0,"href":"../account/login.html#sign-in","outer_html":"PGEgY2xhc3M9Im5hdi1saW5rIiBocmVmPSIuLi9hY2NvdW50L2xvZ2luLmh0bWwjc2lnbi1pbiI+CiAgICAgIAogICAgICAgICA8IS0tP3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtOCI/LS0+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOC4xLjEsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGNsYXNzPSJpY29uIGljb24tc21pbGV5IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMCAyMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTYuNCwxMC4zYzAuOSwwLjMsMS40LTEuMSwwLjctMS42QzYuMiw4LDUuMyw5LjksNi40LDEwLjN6Ij48L3BhdGg+Cgk8cGF0aCBkPSJNMTMuMiw4LjNjMC44LDAsMC45LTEuMywwLjEtMS40QzEyLjUsNi44LDEyLjQsOC4zLDEzLjIsOC4zeiI+PC9wYXRoPgoJPHBhdGggZD0iTTEwLjUsMTEuNWMwLTAuMy0wLjItMS43LTAuNi0xYy0wLjQsMC42LTAuMSwyLjcsMC42LDMuMUMxMC43LDEyLjksMTAuNiwxMi4yLDEwLjUsMTEuNXoiPjwvcGF0aD4KCTxwYXRoIGQ9Ik03LjIsMTQuM2MyLDAuNyw1LjQtMC42LDctMS42YzAuMSwwLjYtMC42LDEuNC0xLjEsMS45Yy0wLjUsMC41LTEuMSwwLjgtMS44LDFjLTEuMSwwLjQtMy40LDAuNi00LjEtMUw3LjIsMTQuM3oiPjwvcGF0aD4KCTxwYXRoIGQ9Ik00LjgsNS41QzQuNSw2LDQuMiw2LjUsNC4xLDdjLTAuNCwxLTAuNSwyLjYtMC4yLDMuN2MwLjQsMi4yLDEuNSw1LjEsMy42LDYuMmMwLjksMC41LDIuMSwwLjksMy4xLDAuOWMxLjIsMCwyLTAuNSwzLTEuMgoJCWMwLjgtMC42LDEuNS0xLjMsMi4yLTIuMmMwLjgtMSwwLjktMi4xLDEuMS0zLjNjMC0wLjMsMC4xLTEuNCwwLjUtMS40YzAuNS0wLjEsMC42LDEsMC42LDEuM2MwLDEuMi0wLjMsMi4zLTAuNywzLjMKCQljLTAuOSwyLjEtMi40LDMuMy00LjUsNC4xYy0yLjIsMC44LTQuNiwwLjctNi43LTAuNGMtMS44LTEtMy0zLjMtMy41LTUuM0MyLDEwLjUsMS44LDcuNywyLjksNS41YzAuNi0xLjEsMS4zLTIuMSwyLjMtMi45CgkJQzYuMSwyLDcuNiwxLjQsOC43LDEuM2MxLjItMC4yLDIuNS0wLjQsMy43LTAuMWMxLjEsMC4yLDIsMC45LDIuOCwxLjdjMS43LDEuOCwyLjcsMy44LDIuNyw2LjNjMCwwLjYsMC4xLDEuMywwLDEuOQoJCWMwLDAuNS0wLjUsMS40LTEsMC43Yy0wLjItMC4zLTAuMS0xLjQtMC4xLTEuOGMwLTAuNS0wLjItMS4xLTAuMy0xLjdjLTAuMy0xLjgtMS4yLTQuNC0yLjktNS40QzEyLjIsMiwxMC43LDIsOS4yLDIuMgoJCUM3LjUsMi42LDUuNiwzLjksNC44LDUuNXoiPjwvcGF0aD4KPC9nPgo8L3N2Zz4KCiAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGlvbi10ZXh0Ij5BY2NvdW50PC9zcGFuPgogICAgICA8L2E+"},{"type":"click","x":217.90625,"y":244.53125,"height":16,"width":167.109375,"x_offset":0,"y_offset":139,"href":"#sign-up","outer_html":"PGEgaHJlZj0iI3NpZ24tdXAiIGNsYXNzPSJmb3Jnb3QtcGFzc3dvcmQtbGluayI+U2lnbiB1cCBmb3IgYW4gYWNjb3VudDwvYT4="},{"type":"click","x":217.90625,"y":253.265625,"height":45.765625,"width":355.171875,"x_offset":0,"y_offset":131,"href":"#","outer_html":"PGlucHV0IGNsYXNzPSJidXR0b24gYnV0dG9uLWJsYWNrIiB0eXBlPSJzdWJtaXQiIHZhbHVlPSJTdWJtaXQiPg=="},{"type":"click","x":164.796875,"y":485.96875,"height":19.984375,"width":101.09375,"x_offset":0,"y_offset":131,"href":"../pages/contact.html","outer_html":"PGEgaHJlZj0iLi4vcGFnZXMvY29udGFjdC5odG1sIiBjbGFzcz0iZm9vdGVyLWxpbmsiPgogICAgICAgICAgICBDb250YWN0IFVzCiAgICAgICAgICA8L2E+"},{"type":"click","x":297.5,"y":61.953125,"height":27,"width":196,"x_offset":0,"y_offset":0,"href":"../index.html","outer_html":"PGEgaHJlZj0iLi4vaW5kZXguaHRtbCIgY2xhc3M9Im5hdi1sb2NrdXAiPgogICAgICAgIDxpbWcgY2xhc3M9Im5hdi1uYXJyb3ctc2hvdyIgc3JjPSIuLi8uLi9jZG4uc2hvcGlmeS5jb20vcy9maWxlcy8xLzA3ODAvNDk5MS90LzI3L2Fzc2V0cy9oZmJfbG9nb18zOTJweDlhNDAucG5nP3Y9Njk5Mjc5MzEzMDIzMTUyNDIxNjE2Nzk2NjI3IiBhbHQ9IkhhbnNlbCBmcm9tIEJhc2VsIj4KICAgICAgICA8aW1nIGNsYXNzPSJuYXYtd2lkZS1zaG93IiBzcmM9Ii4uLy4uL2Nkbi5zaG9waWZ5LmNvbS9zL2ZpbGVzLzEvMDc4MC80OTkxL3QvMjcvYXNzZXRzL2hmYl9sb2dvXzU1MHB4MTI5My5wbmc/dj0xNTcwNzMwMzQxMDEwMzAzMTY0MDE2MTY3OTY2MjgiIGFsdD0iSGFuc2VsIGZyb20gQmFzZWwiPgoKICAgICAgPC9hPg=="}]}'

    return result != null ? JSON.parse(result) as StoreModel : null
  }
}